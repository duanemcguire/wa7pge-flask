<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Game Tally Sheet — Live Leaderboard (Fixed)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 900px; }
    h1 { text-align:center; margin-bottom: 12px; }
    .controls { display:flex; gap:8px; justify-content:center; margin-bottom: 14px; flex-wrap:wrap; }
    input[type="text"]{ padding:8px; min-width:220px; font-size:14px; }
    button { padding:6px 10px; cursor:pointer; }
    table { width:100%; border-collapse:collapse; margin-top:8px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#f4f4f4; }
    .btn-small { padding:4px 8px; margin:2px; }
    .leaderboard { margin-top:18px; padding:12px; border-radius:8px; border:1px solid #ddd; background:#fafafa; }
    .leaderboard h2 { margin:0 0 8px 0; }
    .leaderboard ol { padding-left: 18px; margin:0; }
    .top { font-weight:700; color: #0b6; }
    .no-participants { color:#666; font-style:italic; }
    .actions { display:flex; gap:6px; justify-content:center; }
    @media (max-width:640px) {
      .controls { flex-direction:column; align-items:center; }
      input[type="text"]{ width:100%; max-width:360px; }
    }
  </style>
</head>
<body>
  <h1>Game Tally Sheet</h1>

  <div class="controls" aria-label="Controls">
    <input id="nameInput" type="text" placeholder="Enter participant name" aria-label="Participant name">
    <button id="addBtn" type="button">Add Participant</button>
    <button id="resetBtn" type="button">Reset All Scores</button>
    <button id="clearBtn" type="button" title="Remove all participants">Clear All</button>
  </div>

  <table id="participantsTable" aria-label="Participants table">
    <thead>
      <tr>
        <th style="width:40%;">Name</th>
        <th style="width:15%;">Score</th>
        <th style="width:35%;">Points</th>
        <th style="width:10%;">Remove</th>
      </tr>
    </thead>
    <tbody id="participantBody">
      <!-- rows inserted here -->
    </tbody>
  </table>

  <div class="leaderboard" id="leaderboard" aria-live="polite">
    <h2>Live Leaderboard</h2>
    <div id="leaderContent" class="no-participants">No participants yet.</div>
  </div>
<BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Data model
    let participants = [];
    let nextId = 1;

    // DOM refs
    const nameInput = document.getElementById('nameInput');
    const addBtn = document.getElementById('addBtn');
    const resetBtn = document.getElementById('resetBtn');
    const clearBtn = document.getElementById('clearBtn');
    const participantBody = document.getElementById('participantBody');
    const leaderContent = document.getElementById('leaderContent');

    // Add participant (exposed for fallback)
    function addParticipant() {
      const raw = nameInput.value.trim();
      if (!raw) {
        nameInput.focus();
        return;
      }
      // prevent duplicate names (case-insensitive)
      const exists = participants.some(p => p.name.toLowerCase() === raw.toLowerCase());
      if (exists) {
        nameInput.value = '';
        nameInput.placeholder = 'Name already exists — try a different name';
        setTimeout(() => nameInput.placeholder = 'Enter participant name', 1500);
        return;
      }
      participants.push({ id: nextId++, name: raw, score: 50 });
      nameInput.value = '';
      renderParticipants();
      nameInput.focus();
    }

    function changeScore(id, delta) {
      const p = participants.find(x => x.id === id);
      if (!p) return;
      p.score += delta;
      renderParticipants();
    }

    function removeParticipant(id) {
      participants = participants.filter(p => p.id !== id);
      renderParticipants();
    }

    function resetScores() {
      participants.forEach(p => p.score = 0);
      renderParticipants();
    }

    function renderParticipants() {
      participantBody.innerHTML = '';
      if (participants.length === 0) {
        const r = document.createElement('tr');
        const c = document.createElement('td');
        c.colSpan = 4;
        c.className = 'no-participants';
        c.textContent = 'No participants — add someone above.';
        r.appendChild(c);
        participantBody.appendChild(r);
      } else {
        participants.forEach(p => {
          const tr = document.createElement('tr');

          const nameTd = document.createElement('td');
          nameTd.textContent = p.name;
          nameTd.style.textAlign = 'left';

          const scoreTd = document.createElement('td');
          scoreTd.textContent = p.score;
          scoreTd.className = 'score';
          scoreTd.setAttribute('data-id', p.id);

          const controlsTd = document.createElement('td');
          controlsTd.className = 'actions';
          [10,6,2,-1,-3,-5].forEach(val => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'btn-small';
            btn.textContent = (val > 0 ? '+' : '') + val;
            btn.title = (val > 0 ? 'Add ' : 'Subtract ') + Math.abs(val) + ' points';
            btn.addEventListener('click', () => changeScore(p.id, val));
            controlsTd.appendChild(btn);
          });

          const removeTd = document.createElement('td');
          const removeBtn = document.createElement('button');
          removeBtn.type = 'button';
          removeBtn.textContent = '✖';
          removeBtn.title = 'Remove participant';
          removeBtn.addEventListener('click', () => {
            if (confirm(`Remove "${p.name}"?`)) removeParticipant(p.id);
          });
          removeTd.appendChild(removeBtn);

          tr.appendChild(nameTd);
          tr.appendChild(scoreTd);
          tr.appendChild(controlsTd);
          tr.appendChild(removeTd);
          participantBody.appendChild(tr);
        });
      }

      updateLeaderboard();
    }

    function updateLeaderboard() {
      if (participants.length === 0) {
        leaderContent.innerHTML = '<div class="no-participants">No participants yet.</div>';
        return;
      }

      const sorted = participants.slice().sort((a,b) => {
        if (b.score !== a.score) return b.score - a.score;
        return a.id - b.id;
      });

      const ol = document.createElement('ol');
      ol.style.margin = '6px 0 0 12px';
      sorted.forEach((p, i) => {
        const li = document.createElement('li');
        li.textContent = `${p.name} — ${p.score}`;
        if (i === 0) li.className = 'top';
        ol.appendChild(li);
      });

      leaderContent.innerHTML = '';
      leaderContent.appendChild(ol);
    }

    // Event listeners
    addBtn.addEventListener('click', addParticipant);
    resetBtn.addEventListener('click', resetScores);
    clearBtn.addEventListener('click', () => {
      if (!confirm('Remove all participants?')) return;
      participants = [];
      renderParticipants();
    });
    nameInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') addParticipant();
    });

    // Expose for console / inline fallback (if needed)
    window.addParticipant = addParticipant;

    // initial render
    renderParticipants();
  });
  </script>
</body>
</html>
